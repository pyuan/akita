(function(a){a.fn.akita=function(b){if(b==a.akita.DESTROY_COMMAND){b={isDestroy:true}}var e=a.extend({},a.fn.akita.options,b);return this.each(function(){if(!d(e)){var f=a.extend({},e);f.element=a(this);a(this).data(a.akita.NAMESPACE,f);a(this).bind(e.showEvent+"."+a.akita.NAMESPACE,function(){var g=a(this).data(a.akita.NAMESPACE);a.akita.show(g)});if(e.showTime==-1&&e.hideEvent){a(this).bind(e.hideEvent+"."+a.akita.NAMESPACE,function(){var g=a(this).data(a.akita.NAMESPACE);a.akita.hide(g)})}c()}else{a.akita.hide();a(this).unbind(e.showEvent+"."+a.akita.NAMESPACE);a(this).unbind(e.hideEvent+"."+a.akita.NAMESPACE);a(this).removeData(a.akita.NAMESPACE)}});function d(f){var g=f.isDestroy;return g}function c(){a(window).unbind("resize."+a.akita.NAMESPACE).bind("resize."+a.akita.NAMESPACE,function(){a.akita.respositionAll()}).unbind("scroll."+a.akita.NAMESPACE).bind("scroll."+a.akita.NAMESPACE,function(){a.akita.respositionAll()})}};a.fn.akita.options={content:"This is an <b><i>Akita</i></b> Speech Bubble",animationTime:150,showTime:-1,maxWidth:200,backgroundColor:"#1a1a1a",fontColor:"#eaeaea",showEvent:"mouseenter",hideEvent:"mouseleave",placement:"auto",x:-1,y:-1,element:undefined,isDestroy:false}})(jQuery);jQuery.extend({akita:{NAMESPACE:"akita",DESTROY_COMMAND:"destroy",SPEECH_BUBBLE_CLASS:"akitaSpeechBubble",PLACEMENT_MARGIN:15,SPEECH_BUBBLE_TIP_LENGTH:10,PLACEMENT_TOP:"top",PLACEMENT_BOTTOM:"bottom",PLACEMENT_LEFT:"left",PLACEMENT_RIGHT:"right",PLACEMENT_TOPLEFT:"topLeft",PLACEMENT_TOPRIGHT:"topRight",PLACEMENT_BOTTOMLEFT:"bottomLeft",PLACEMENT_BOTTOMRIGHT:"bottomRight",PLACEMENT_AUTO:"auto",show:function(j){if(!j||(j.x==-1||j.y==-1)&&!j.element){throw"Please specify the x, y position OR a DOM element to create the Akita Speech Bubble"}if(j.element){var k=false;$("."+this.SPEECH_BUBBLE_CLASS).each(function(){var l=$(this).data($.akita.NAMESPACE);if($(l.element).is(j.element)){k=true;return false}});if(k){return false}}j=$.extend({},$.fn.akita.options,j);this.hide(j);var c=$("<div/>").addClass("akita_content").html(j.content);$(c).css("max-width",j.maxWidth).css("color",j.fontColor);var i=$("<div/>").addClass("akita_content_background");$(i).css("background-color",j.backgroundColor);var d=$("<div/>").addClass("akita_content_container");$(d).append(i).append(c);var b=$("<div/>").addClass(this.SPEECH_BUBBLE_CLASS).hide();$(b).append(d);$(b).data($.akita.NAMESPACE,j);$("body").append(b);var f=this.getSpeechBubblePosition(b,j);if(j.placement!=this.PLACEMENT_AUTO){f=this.getSpeechBubblePositionBasedOnPlacement(b,j)}if(this.hasCanvasSupport()){var h=$("<canvas/>").addClass("akita_speech_bubble_tip").attr("width",this.SPEECH_BUBBLE_TIP_LENGTH).attr("height",this.SPEECH_BUBBLE_TIP_LENGTH);$(b).append(h);var a=$(h).get(0).getContext("2d");if(a){a.strokeStyle="#cccccc";a.lineWidth=1;a.fillStyle=j.backgroundColor;a.beginPath();a.moveTo(0,0);a.lineTo(this.SPEECH_BUBBLE_TIP_LENGTH/2,this.SPEECH_BUBBLE_TIP_LENGTH);a.lineTo(this.SPEECH_BUBBLE_TIP_LENGTH,0);a.lineTo(0,0);a.fill();a.stroke();a.closePath()}var g=0;var e=0;switch(f.placement){case this.PLACEMENT_TOP:g=($(b).width()-this.SPEECH_BUBBLE_TIP_LENGTH)/2;e=$(b).height()-1;break;case this.PLACEMENT_BOTTOM:g=($(b).width()-this.SPEECH_BUBBLE_TIP_LENGTH)/2;e=-this.SPEECH_BUBBLE_TIP_LENGTH+1;this.rotateElement(h,180);break;case this.PLACEMENT_LEFT:g=$(b).width()-1;e=($(b).height()-this.SPEECH_BUBBLE_TIP_LENGTH)/2;this.rotateElement(h,-90);break;case this.PLACEMENT_RIGHT:g=-this.SPEECH_BUBBLE_TIP_LENGTH+1;e=($(b).height()-this.SPEECH_BUBBLE_TIP_LENGTH)/2;this.rotateElement(h,90);break;case this.PLACEMENT_TOPLEFT:g=$(b).width()-1;e=this.SPEECH_BUBBLE_TIP_LENGTH;this.rotateElement(h,-90);break;case this.PLACEMENT_BOTTOMLEFT:g=$(b).width()-1;e=$(b).height()-this.SPEECH_BUBBLE_TIP_LENGTH*2;this.rotateElement(h,-90);break;case this.PLACEMENT_TOPRIGHT:g=-this.SPEECH_BUBBLE_TIP_LENGTH+1;e=this.SPEECH_BUBBLE_TIP_LENGTH;this.rotateElement(h,90);break;case this.PLACEMENT_BOTTOMRIGHT:g=-this.SPEECH_BUBBLE_TIP_LENGTH+1;e=$(b).height()-this.SPEECH_BUBBLE_TIP_LENGTH*2;this.rotateElement(h,90);break}$(h).css("left",g+"px").css("top",e+"px")}$(b).css("left",f.x+"px").css("top",f.y+"px").stop().fadeIn(j.animationTime,function(){if(j.showTime>=0){var l=setTimeout(function(){$.akita.hide(j);clearTimeout(l)},j.showTime)}});return b},hide:function(a){a=$.extend({},$.fn.akita.options,a);var b=function(c,d){$(c).stop().fadeOut(d,function(){$(this).remove()})};if(a.element){$("."+this.SPEECH_BUBBLE_CLASS).each(function(){var c=$(this).data($.akita.NAMESPACE);if($(c.element).is(a.element)){b($(this),c.animationTime);return false}})}else{b($("."+this.SPEECH_BUBBLE_CLASS),a.animationTime)}},hasCanvasSupport:function(){var a=document.createElement("canvas");return !!(a.getContext&&a.getContext("2d"))},rotateElement:function(a,c){var b="rotate("+c+"deg)";$(a).css("-webkit-transform",b).css("-moz-transform",b);return a},getSpeechBubblePosition:function(e,c){var g=this.getElementPosition($(c.element).get(0));var d=this.PLACEMENT_TOP;var b=c.x;if(b==-1&&c.element){b=g.x;b+=($(c.element).width()-$(e).width())/2}var f=c.y;if(f==-1&&c.element){f=g.y;f-=$(e).height()+$.akita.PLACEMENT_MARGIN}if(b+$(e).width()>$("body").scrollLeft()+$(window).width()-$.akita.PLACEMENT_MARGIN){b=g.x-$(e).width()-$.akita.PLACEMENT_MARGIN;f=g.y+($(c.element).height()-$(e).height())/2;d=this.PLACEMENT_LEFT}else{if(b<$("body").scrollLeft()+$.akita.PLACEMENT_MARGIN){b=g.x+$(c.element).width()+$.akita.PLACEMENT_MARGIN;f=g.y+($(c.element).height()-$(e).height())/2;d=this.PLACEMENT_RIGHT}}if(f<$("body").scrollTop()+$.akita.PLACEMENT_MARGIN){if(d!=this.PLACEMENT_TOP){f=$("body").scrollTop()+$.akita.PLACEMENT_MARGIN;d=d==this.PLACEMENT_RIGHT?this.PLACEMENT_TOPRIGHT:this.PLACEMENT_TOPLEFT}else{f=g.y+$(c.element).height()+$.akita.PLACEMENT_MARGIN;d=this.PLACEMENT_BOTTOM}}if(f+$(e).height()>$("body").height()-$.akita.PLACEMENT_MARGIN){f=$("body").height()-$(e).height()-$.akita.PLACEMENT_MARGIN;if(d==this.PLACEMENT_TOP){d=this.PLACEMENT_BOTTOM}else{d=d==this.PLACEMENT_RIGHT?this.PLACEMENT_BOTTOMRIGHT:this.PLACEMENT_BOTTOMLEFT}}var a={x:b,y:f,placement:d};return a},getSpeechBubblePositionBasedOnPlacement:function(d,c){var b=0;var f=0;var e=this.getElementPosition($(c.element).get(0));switch(c.placement){case this.PLACEMENT_TOP:b=e.x+($(c.element).width()-$(d).width())/2;f=e.y-$(d).height()+$.akita.PLACEMENT_MARGIN;break;case this.PLACEMENT_BOTTOM:b=e.x+($(c.element).width()-$(d).width())/2;f=e.y+$(c.element).height()+$.akita.PLACEMENT_MARGIN;break;case this.PLACEMENT_LEFT:b=e.x-$(d).width()-$.akita.PLACEMENT_MARGIN;f=e.y+($(c.element).height()-$(d).height())/2;break;case this.PLACEMENT_RIGHT:b=e.x+$(c.element).width()+$.akita.PLACEMENT_MARGIN;f=e.y+($(c.element).height()-$(d).height())/2;break}var a={x:b,y:f,placement:c.placement};return a},getElementPosition:function(a){var b={x:0,y:0};if(a){b={x:$(a).offset().left,y:$(a).offset().top}}return b},setDefaults:function(a){var b=$.extend({},$.fn.akita.options,a);$.fn.akita.options=b},getHTML:function(a){return $(a).clone().wrap("<div></div>").parent().html()},respositionAll:function(){$("."+this.SPEECH_BUBBLE_CLASS).each(function(){if(!$(this).is(":animated")){var a=$(this).data($.akita.NAMESPACE);$(this).remove();$.akita.show(a)}})}}});